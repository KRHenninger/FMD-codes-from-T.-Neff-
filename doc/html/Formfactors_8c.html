<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>FMD: fmd/Formfactors.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<h1>fmd/Formfactors.c File Reference</h1>  </div>
</div>
<div class="contents">
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;complex.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="Gaussian_8h_source.html">Gaussian.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="SlaterDet_8h_source.html">SlaterDet.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="CenterofMass_8h_source.html">CenterofMass.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="Formfactors_8h_source.html">Formfactors.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cmath_8h_source.html">numerics/cmath.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="gaussquad_8h_source.html">numerics/gaussquad.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sphericalharmonics_8h_source.html">numerics/sphericalharmonics.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sphericalbessel_8h_source.html">numerics/sphericalbessel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">misc/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="physics_8h_source.html">misc/physics.h</a>&quot;</code><br/>

<p><a href="Formfactors_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(<a class="el" href="donlp2_8h.html#a693a5a39c68cf597f5264260a0f2e380">x</a>)&nbsp;&nbsp;&nbsp;((<a class="el" href="donlp2_8h.html#a693a5a39c68cf597f5264260a0f2e380">x</a>)*(<a class="el" href="donlp2_8h.html#a693a5a39c68cf597f5264260a0f2e380">x</a>))</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#a0535cd6d9e8c9266472ff1d5f8f5f6f4">initOpFormfactors</a> (<a class="el" href="structFormfactorPara.html">FormfactorPara</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#ab2c55582dfa6bab91946cc148b3578cd">par</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#adb43e15da3c3792d45179fa3c74786a2">calcFormfactorod</a> (double <a class="el" href="MinimizerDONLP2vappiso_8c.html#a116d67c73cdfa395275c96c0151ddcd4">q</a>[3], int recoil, const <a class="el" href="structSlaterDet.html">SlaterDet</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#ac4f7151b4c1c951d242ff9f8856381a0">Q</a>, const <a class="el" href="structSlaterDet.html">SlaterDet</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a302070733a377867b458d28f3146454f">Qp</a>, const <a class="el" href="structSlaterDetAux.html">SlaterDetAux</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a40641ce31f478e07b357ff308ee3e47f">X</a>, complex double ffactor[2])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#a05e5e93b5c85a383d9a5c1801571a7b6">calcMultipoleFormfactorsod</a> (<a class="el" href="structFormfactorPara.html">FormfactorPara</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#ab2c55582dfa6bab91946cc148b3578cd">par</a>, const <a class="el" href="structSlaterDet.html">SlaterDet</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#ac4f7151b4c1c951d242ff9f8856381a0">Q</a>, const <a class="el" href="structSlaterDet.html">SlaterDet</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a302070733a377867b458d28f3146454f">Qp</a>, const <a class="el" href="structSlaterDetAux.html">SlaterDetAux</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a40641ce31f478e07b357ff308ee3e47f">X</a>, complex double *ffactor)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#a81e93d93df8e3d7ab71144f2d011fcc3">writePointFormfactors</a> (FILE *fp, const <a class="el" href="structProjection.html">Projection</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a937218b25a684555a6d94a5058c7b358">P</a>, const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *p, int <a class="el" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a>, int <a class="el" href="MinimizerDONLP2vappiso_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>, int pi, int a, void *ffactorme, const <a class="el" href="structEigenstates.html">Eigenstates</a> *E)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#ae39dd2947271bd127bb37eaf2b1d100f">writeChargeFormfactors</a> (FILE *fp, const <a class="el" href="structProjection.html">Projection</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a937218b25a684555a6d94a5058c7b358">P</a>, const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *p, int <a class="el" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a>, int <a class="el" href="MinimizerDONLP2vappiso_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>, int pi, int a, void *ffactorme, const <a class="el" href="structEigenstates.html">Eigenstates</a> *E)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#a9fc5d29aff37ebaeb3b7753c06c1697c">writeTransitionPointFormfactors</a> (FILE *fp, const <a class="el" href="structProjection.html">Projection</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a937218b25a684555a6d94a5058c7b358">P</a>, const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *p, int <a class="el" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a>, int jfin, int pfin, int afin, int jini, int pini, int aini, void *ffactorme, const <a class="el" href="structEigenstates.html">Eigenstates</a> *E)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#a4866d0d52658593657bb329703db48a2">writeTransitionChargeFormfactors</a> (FILE *fp, const <a class="el" href="structProjection.html">Projection</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a937218b25a684555a6d94a5058c7b358">P</a>, const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *p, int <a class="el" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a>, int jfin, int pfin, int afin, int jini, int pini, int aini, void *ffactorme, const <a class="el" href="structEigenstates.html">Eigenstates</a> *E)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#a66ef1a04e19407e0fe6b0ef8ba880102">writePointDensities</a> (FILE *fp, const <a class="el" href="structProjection.html">Projection</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a937218b25a684555a6d94a5058c7b358">P</a>, const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *p, double rmax, int npointsr, int A, int <a class="el" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a>, int <a class="el" href="MinimizerDONLP2vappiso_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>, int pi, int a, void *ffactorme, const <a class="el" href="structEigenstates.html">Eigenstates</a> *E)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#accfbeb77b13941ef885f61391b0153cb">writeMatterDensities</a> (FILE *fp, const <a class="el" href="structProjection.html">Projection</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a937218b25a684555a6d94a5058c7b358">P</a>, const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *p, double rmax, int npointsr, int A, int <a class="el" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a>, int <a class="el" href="MinimizerDONLP2vappiso_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>, int pi, int a, void *ffactorme, const <a class="el" href="structEigenstates.html">Eigenstates</a> *E)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#a17b425ec175de4ce746eacdc2f054b24">writeChargeDensities</a> (FILE *fp, const <a class="el" href="structProjection.html">Projection</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a937218b25a684555a6d94a5058c7b358">P</a>, const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *p, double rmax, int npointsr, int Z, int <a class="el" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a>, int <a class="el" href="MinimizerDONLP2vappiso_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>, int pi, int a, void *ffactorme, const <a class="el" href="structEigenstates.html">Eigenstates</a> *E)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#a89efe28c922813f3699a6633da4da252">writeChargeFourierBessel</a> (FILE *fp, const <a class="el" href="structProjection.html">Projection</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a937218b25a684555a6d94a5058c7b358">P</a>, const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *p, double rmax, int npointsr, int Z, int <a class="el" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a>, int <a class="el" href="MinimizerDONLP2vappiso_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>, int pi, int a, void *ffactorme, const <a class="el" href="structEigenstates.html">Eigenstates</a> *E)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#a43ac3e4aa3126633881db8c44e82d79c">writeTransitionPointDensities</a> (FILE *fp, const <a class="el" href="structProjection.html">Projection</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a937218b25a684555a6d94a5058c7b358">P</a>, const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *p, double rmax, int npointsr, int A, int <a class="el" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a>, int jfin, int pfin, int afin, int jini, int pini, int aini, void *ffactorme, const <a class="el" href="structEigenstates.html">Eigenstates</a> *E)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#a64298611e7dd254daf375af9f29b5258">writeTransitionChargeDensities</a> (FILE *fp, const <a class="el" href="structProjection.html">Projection</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a937218b25a684555a6d94a5058c7b358">P</a>, const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *p, double rmax, int npointsr, int Z, int <a class="el" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a>, int jfin, int pfin, int afin, int jini, int pini, int aini, void *ffactorme, const <a class="el" href="structEigenstates.html">Eigenstates</a> *E)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#afb73a957aa0d7094666a6e42c78e3968">writeTransitionChargeFourierBessel</a> (FILE *fp, const <a class="el" href="structProjection.html">Projection</a> *<a class="el" href="MinimizerDONLP2vappiso_8c.html#a937218b25a684555a6d94a5058c7b358">P</a>, const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *p, double rmax, int npointsr, int Z, int <a class="el" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a>, int jfin, int pfin, int afin, int jini, int pini, int aini, void *ffactorme, const <a class="el" href="structEigenstates.html">Eigenstates</a> *E)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#ae91c198a9dcb2a8656748bd22d1c2dea">fflabel</a> [NMULTIPOLES]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structManyBodyOperator.html">ManyBodyOperator</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#ae9b23ef5773aed752a74d4f815eb992d">OpMultipoleFormfactor</a> [NMULTIPOLES]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structManyBodyOperators.html">ManyBodyOperators</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#a590d8229561cc50d158aad7a0481d2bc">OpMultipoleFormfactors</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#ad0f7f465a16cc1f1a73d9f2f7f799647">il</a> [NMULTIPOLES] = {0, 1, 4, 9}</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Formfactors_8c.html#ac00848d0b72a3c999e09ad3573a7b358">diml</a> [NMULTIPOLES] = {1, 3, 5, 7}</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>calculate formfactors center of mass motion is treated exactly</p>
<p>(c) 2004-2007 Thomas Neff </p>

<p>Definition in file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="aa7866fa5e4e0ee9b034e9dab6599a9cc"></a><!-- doxytag: member="Formfactors.c::SQR" ref="aa7866fa5e4e0ee9b034e9dab6599a9cc" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SQR</td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"><a class="el" href="donlp2_8h.html#a693a5a39c68cf597f5264260a0f2e380">x</a></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;((<a class="el" href="donlp2_8h.html#a693a5a39c68cf597f5264260a0f2e380">x</a>)*(<a class="el" href="donlp2_8h.html#a693a5a39c68cf597f5264260a0f2e380">x</a>))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00033">33</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="adb43e15da3c3792d45179fa3c74786a2"></a><!-- doxytag: member="Formfactors.c::calcFormfactorod" ref="adb43e15da3c3792d45179fa3c74786a2" args="(double q[3], int recoil, const SlaterDet *Q, const SlaterDet *Qp, const SlaterDetAux *X, complex double ffactor[2])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calcFormfactorod </td>
          <td>(</td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>q</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>recoil</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structSlaterDet.html">SlaterDet</a> *&nbsp;</td>
          <td class="paramname"> <em>Q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structSlaterDet.html">SlaterDet</a> *&nbsp;</td>
          <td class="paramname"> <em>Qp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structSlaterDetAux.html">SlaterDetAux</a> *&nbsp;</td>
          <td class="paramname"> <em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">complex double&nbsp;</td>
          <td class="paramname"> <em>ffactor</em>[2]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00101">101</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>References <a class="el" href="SlaterDet_8c_source.html#l00264">boostSlaterDet()</a>, <a class="el" href="SlaterDet_8c_source.html#l00468">calcSlaterDetAuxod()</a>, <a class="el" href="SlaterDet_8c_source.html#l00736">calcSlaterDetOBMEod()</a>, <a class="el" href="SlaterDet_8c_source.html#l00180">copySlaterDet()</a>, <a class="el" href="MinimizerDONLP2multivapp_8c_source.html#l00122">dim</a>, <a class="el" href="SlaterDet_8c_source.html#l00041">initSlaterDet()</a>, <a class="el" href="SlaterDet_8c_source.html#l00414">initSlaterDetAux()</a>, <a class="el" href="physics_8c_source.html#l00033">mneutron</a>, <a class="el" href="physics_8c_source.html#l00032">mproton</a>, <a class="el" href="SlaterDet_8h_source.html#l00032">SlaterDet::N</a>, <a class="el" href="MinimizerDONLP2multivapp_8c_source.html#l00103">par</a>, and <a class="el" href="SlaterDet_8h_source.html#l00031">SlaterDet::Z</a>.</p>

<p>Referenced by <a class="el" href="Formfactors_8c_source.html#l00133">calcMultipoleFormfactorsod()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="comment">// inititialize workspace if necessary</span>
  <span class="keywordflow">if</span> (recoil &amp;&amp; !Qboost) {
    Qboost = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structSlaterDet.html" title="Slater Determinant.">SlaterDet</a>));
    <a class="code" href="SlaterDet_8c.html#a16db6f53cfee239b7d506c86bc372686">initSlaterDet</a>(Qp, Qboost);
    Xboost = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structSlaterDetAux.html">SlaterDetAux</a>));
    <a class="code" href="SlaterDet_8c.html#a9d28b849a027b454fd2eddb812a884c5" title="init SlaterDetAux X">initSlaterDetAux</a>(Qp, Xboost);
  }

  <a class="code" href="structOneBodyOperator.html">OneBodyOperator</a> op_ob_formfactorq = {<a class="code" href="MinimizerDONLP2multivapp_8c.html#ad5bd801f521717ed9f092360c3ba3b5e">dim</a>: 2, opt: 1, <a class="code" href="MinimizerDONLP2multivapp_8c.html#ab2c55582dfa6bab91946cc148b3578cd">par</a>: <a class="code" href="MinimizerDONLP2_8c.html#a116d67c73cdfa395275c96c0151ddcd4">q</a>,
                                       me : ob_formfactorq};

  <span class="keywordflow">if</span> (recoil) { 
    <span class="keywordtype">double</span> mass = Q-&gt;<a class="code" href="structSlaterDet.html#a6c7238078110732052290c5feb3fcecb" title="number of protons">Z</a>*<a class="code" href="physics_8c.html#a8eb62e76681c15cad3ccab9c10160c14" title="proton mass [fm^-1]">mproton</a>+Q-&gt;<a class="code" href="structSlaterDet.html#aba9b875a3a8af9a9056dc7d1a48934ac" title="number of neutrons">N</a>*<a class="code" href="physics_8c.html#a2da201ca1cde1f55795ebdf8f65c524d" title="neutron mass [fm^-1]">mneutron</a>;
    <span class="keywordtype">double</span> Vcm[3] = {-<a class="code" href="MinimizerDONLP2_8c.html#a116d67c73cdfa395275c96c0151ddcd4">q</a>[0]/mass, -<a class="code" href="MinimizerDONLP2_8c.html#a116d67c73cdfa395275c96c0151ddcd4">q</a>[1]/mass, -<a class="code" href="MinimizerDONLP2_8c.html#a116d67c73cdfa395275c96c0151ddcd4">q</a>[2]/mass};

    <a class="code" href="SlaterDet_8c.html#acd974ea424b0829a55ada79fc69abd90">copySlaterDet</a>(Qp, Qboost);
    <a class="code" href="SlaterDet_8c.html#ad154093b24c00e82ac9129d87cd2e049" title="boost Slater determinant with speed v">boostSlaterDet</a>(Qboost, Vcm);
    <a class="code" href="SlaterDet_8c.html#ad3679a655d9b6019619456e5b7961638">calcSlaterDetAuxod</a>(Q, Qboost, Xboost);
    <a class="code" href="SlaterDet_8c.html#a269a329a135cbb79c8defd0ec551eb45">calcSlaterDetOBMEod</a>(Q, Qboost, Xboost, &amp;op_ob_formfactorq, ffactor);
  } <span class="keywordflow">else</span> 
    <a class="code" href="SlaterDet_8c.html#a269a329a135cbb79c8defd0ec551eb45">calcSlaterDetOBMEod</a>(Q, Qp, X, &amp;op_ob_formfactorq, ffactor);
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a05e5e93b5c85a383d9a5c1801571a7b6"></a><!-- doxytag: member="Formfactors.c::calcMultipoleFormfactorsod" ref="a05e5e93b5c85a383d9a5c1801571a7b6" args="(FormfactorPara *par, const SlaterDet *Q, const SlaterDet *Qp, const SlaterDetAux *X, complex double *ffactor)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calcMultipoleFormfactorsod </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFormfactorPara.html">FormfactorPara</a> *&nbsp;</td>
          <td class="paramname"> <em>par</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structSlaterDet.html">SlaterDet</a> *&nbsp;</td>
          <td class="paramname"> <em>Q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structSlaterDet.html">SlaterDet</a> *&nbsp;</td>
          <td class="paramname"> <em>Qp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structSlaterDetAux.html">SlaterDetAux</a> *&nbsp;</td>
          <td class="paramname"> <em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">complex double *&nbsp;</td>
          <td class="paramname"> <em>ffactor</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00133">133</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>References <a class="el" href="MinimizerDONLP2multivapp_8c_source.html#l00107">alpha</a>, <a class="el" href="Formfactors_8c_source.html#l00101">calcFormfactorod()</a>, <a class="el" href="gaussquad_8c_source.html#l00045">GaussLegendrePoints()</a>, <a class="el" href="MinimizerDONLP2orthogonalproj_8c_source.html#l00098">k</a>, <a class="el" href="HOBasis_8c_source.html#l00050">l</a>, <a class="el" href="HOBasis_8c_source.html#l00051">m</a>, <a class="el" href="Formfactors_8h_source.html#l00028">FormfactorPara::nalpha</a>, <a class="el" href="Formfactors_8h_source.html#l00029">FormfactorPara::ncosb</a>, <a class="el" href="Formfactors_8h_source.html#l00027">FormfactorPara::npoints</a>, <a class="el" href="Formfactors_8h_source.html#l00026">FormfactorPara::qmax</a>, <a class="el" href="Formfactors_8h_source.html#l00030">FormfactorPara::recoil</a>, <a class="el" href="gaussquad_8c_source.html#l00255">ShiftedPeriodicTrapezoidalPoints()</a>, and <a class="el" href="sphericalharmonics_8c_source.html#l00025">Y()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> qmax = par-&gt;<a class="code" href="structFormfactorPara.html#a1e3e2bcd9f63c49e819a5916614673e1">qmax</a>;
  <span class="keywordtype">int</span> ialpha, nalpha = par-&gt;<a class="code" href="structFormfactorPara.html#acb78497d00ac5db313908c9b3eef26b4">nalpha</a>;
  <span class="keywordtype">int</span> icosb, ncosb = par-&gt;<a class="code" href="structFormfactorPara.html#a83129bd366783606055c6139f3e40690">ncosb</a>;
  <span class="keywordtype">int</span> npoints = par-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
  <span class="keywordtype">int</span> recoil = par-&gt;<a class="code" href="structFormfactorPara.html#aada99dee6e54eb4c9c2fe582f8b6837f">recoil</a>;
  <span class="keywordtype">int</span> <a class="code" href="HOBasis_8c.html#a742204794ea328ba293fe59cec79b990">m</a>, i, t, <a class="code" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a>;
  <span class="keywordtype">double</span> <a class="code" href="MinimizerDONLP2multivapp_8c.html#a20f4c4490bc8ecbdd1ffcb79acce6035" title="finestructure constant">alpha</a>, beta, weight;
  <span class="keywordtype">double</span> <a class="code" href="MinimizerDONLP2_8c.html#a116d67c73cdfa395275c96c0151ddcd4">q</a>, <a class="code" href="MinimizerDONLP2orthogonalproj_8c.html#ab66ed8e0098c0a86b458672a55a9cca9">k</a>[3];
  complex <span class="keywordtype">double</span> ff[2];

  <span class="keywordflow">for</span> (l=0; l&lt;NMULTIPOLES; l++)
    <span class="keywordflow">for</span> (t=0; t&lt;2; t++)
      <span class="keywordflow">for</span> (i=0; i&lt;npoints; i++)
        <span class="keywordflow">for</span> (m=0; m&lt;<a class="code" href="Formfactors_8c.html#ac00848d0b72a3c999e09ad3573a7b358">diml</a>[l]; m++)
          ffactor[m + i*diml[l] + t*diml[l]*npoints + <a class="code" href="Formfactors_8c.html#ad0f7f465a16cc1f1a73d9f2f7f799647">il</a>[l]*2*npoints] = 0.0;

  <span class="keywordtype">double</span> alphal[nalpha], walphal[nalpha];
  <span class="keywordtype">double</span> cosbl[ncosb], wcosbl[ncosb];
  
  <a class="code" href="gaussquad_8c.html#a4c0554e8a66b1be46ead18ca02290a2d">ShiftedPeriodicTrapezoidalPoints</a>(nalpha, 0, 2*M_PI, 0.0, alphal, walphal);
  <a class="code" href="gaussquad_8c.html#aef4fbaefecb9e1201af41ba17d6f8845" title="weight function 1">GaussLegendrePoints</a>(ncosb, -1, 1, cosbl, wcosbl); 

  <span class="keywordflow">for</span> (i=0; i&lt;npoints; i++) {
    q = qmax* i/(npoints-1);
    <span class="keywordflow">for</span> (ialpha=0; ialpha&lt;nalpha; ialpha++)
      <span class="keywordflow">for</span> (icosb=0; icosb&lt;ncosb; icosb++) {
        alpha = alphal[ialpha];
        beta = acos(cosbl[icosb]);
        weight = walphal[ialpha]*wcosbl[icosb];

        k[0] = q*cos(alpha)*sin(beta);
        k[1] = q*sin(alpha)*sin(beta);
        k[2] = q*cos(beta);

        <a class="code" href="Formfactors_8c.html#adb43e15da3c3792d45179fa3c74786a2">calcFormfactorod</a>(k, recoil, Q, Qp, X, ff);
        <span class="keywordflow">for</span> (l=0; l&lt;NMULTIPOLES; l++)
          <span class="keywordflow">for</span> (t=0; t&lt;2; t++)
            <span class="keywordflow">for</span> (m=-l; m&lt;=l; m++)
              ffactor[m+l + i*diml[l] + t*diml[l]*npoints + <a class="code" href="Formfactors_8c.html#ad0f7f465a16cc1f1a73d9f2f7f799647">il</a>[l]*2*npoints] += 
                weight* ff[t]* <a class="code" href="sphericalharmonics_8c.html#a4517398bd7d1af1c7b318fab1d18dde0">Y</a>(2*l,2*m,beta,alpha);
        }
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0535cd6d9e8c9266472ff1d5f8f5f6f4"></a><!-- doxytag: member="Formfactors.c::initOpFormfactors" ref="a0535cd6d9e8c9266472ff1d5f8f5f6f4" args="(FormfactorPara *par)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initOpFormfactors </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFormfactorPara.html">FormfactorPara</a> *&nbsp;</td>
          <td class="paramname"> <em>par</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00055">55</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>References <a class="el" href="Projection_8h_source.html#l00115">ManyBodyOperator::dim</a>, <a class="el" href="Projection_8h_source.html#l00130">ManyBodyOperators::dim</a>, <a class="el" href="Formfactors_8c_source.html#l00039">fflabel</a>, <a class="el" href="Projection_8h_source.html#l00118">ManyBodyOperator::me</a>, <a class="el" href="Formfactors_8h_source.html#l00028">FormfactorPara::nalpha</a>, <a class="el" href="Projection_8h_source.html#l00112">ManyBodyOperator::name</a>, <a class="el" href="Formfactors_8h_source.html#l00029">FormfactorPara::ncosb</a>, <a class="el" href="Formfactors_8h_source.html#l00027">FormfactorPara::npoints</a>, <a class="el" href="Projection_8h_source.html#l00117">ManyBodyOperator::par</a>, <a class="el" href="Projection_8h_source.html#l00129">ManyBodyOperators::par</a>, <a class="el" href="Projection_8h_source.html#l00114">ManyBodyOperator::pi</a>, <a class="el" href="Formfactors_8h_source.html#l00026">FormfactorPara::qmax</a>, <a class="el" href="Projection_8h_source.html#l00113">ManyBodyOperator::rank</a>, <a class="el" href="Formfactors_8h_source.html#l00030">FormfactorPara::recoil</a>, <a class="el" href="Projection_8h_source.html#l00116">ManyBodyOperator::size</a>, and <a class="el" href="Projection_8h_source.html#l00131">ManyBodyOperators::size</a>.</p>

<p>Referenced by <a class="el" href="calcchargedensities_8c_source.html#l00029">main()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i;

  <a class="code" href="Formfactors_8c.html#a590d8229561cc50d158aad7a0481d2bc">OpMultipoleFormfactors</a>.<a class="code" href="structManyBodyOperators.html#aa1b09f1ea3ecfedd76ca27f7954ce65b" title="has to be the same for all Operators">dim</a> = 2*par-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
  <a class="code" href="Formfactors_8c.html#a590d8229561cc50d158aad7a0481d2bc">OpMultipoleFormfactors</a>.<a class="code" href="structManyBodyOperators.html#a94494657638d56cc4a332f00aefcd1e4">size</a> = 2*par-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
  <a class="code" href="Formfactors_8c.html#a590d8229561cc50d158aad7a0481d2bc">OpMultipoleFormfactors</a>.<a class="code" href="structManyBodyOperators.html#a63b81b5a508a075fd10b76ebd219094f" title="the same for all operators">par</a> = par;

  <span class="keywordflow">for</span> (i=0; i&lt;NMULTIPOLES; i++) {
    <span class="keywordtype">char</span>* name = malloc(60);
    sprintf(name, <span class="stringliteral">&quot;%sFormfactors-%05.2f-%d-%d-%d%s&quot;</span>,
            <a class="code" href="Formfactors_8c.html#ae91c198a9dcb2a8656748bd22d1c2dea">fflabel</a>[i],
            par-&gt;<a class="code" href="structFormfactorPara.html#a1e3e2bcd9f63c49e819a5916614673e1">qmax</a>, par-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>, par-&gt;<a class="code" href="structFormfactorPara.html#acb78497d00ac5db313908c9b3eef26b4">nalpha</a>, par-&gt;<a class="code" href="structFormfactorPara.html#a83129bd366783606055c6139f3e40690">ncosb</a>, 
            par-&gt;<a class="code" href="structFormfactorPara.html#aada99dee6e54eb4c9c2fe582f8b6837f">recoil</a> ? <span class="stringliteral">&quot;-recoil&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
    <a class="code" href="Formfactors_8c.html#ae9b23ef5773aed752a74d4f815eb992d">OpMultipoleFormfactor</a>[i].<a class="code" href="structManyBodyOperator.html#a4262723cd836949c28d7b922bc7178cd" title="uniquely identify operator including parameters">name</a> = name;
    <a class="code" href="Formfactors_8c.html#ae9b23ef5773aed752a74d4f815eb992d">OpMultipoleFormfactor</a>[i].<a class="code" href="structManyBodyOperator.html#a2839a5170dccc5c19a75a414cccc710f" title="tensor rank of operator, 0 scalar, 2 vector, ...">rank</a> = 2*i;
    <a class="code" href="Formfactors_8c.html#ae9b23ef5773aed752a74d4f815eb992d">OpMultipoleFormfactor</a>[i].<a class="code" href="structManyBodyOperator.html#a78ec7c9f2238907255cf499427676907" title="parity of operator, 0 positve, 1 negative">pi</a> = i % 2;
    <a class="code" href="Formfactors_8c.html#ae9b23ef5773aed752a74d4f815eb992d">OpMultipoleFormfactor</a>[i].<a class="code" href="structManyBodyOperator.html#a9d2fc8f9d519079b19667ee3c96615db" title="dimension of operator">dim</a> = 2*par-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
    <a class="code" href="Formfactors_8c.html#ae9b23ef5773aed752a74d4f815eb992d">OpMultipoleFormfactor</a>[i].<a class="code" href="structManyBodyOperator.html#a5597272550b373aa2136125a67e5d080" title="might be bigger than dimension">size</a> = 2*par-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
    <a class="code" href="Formfactors_8c.html#ae9b23ef5773aed752a74d4f815eb992d">OpMultipoleFormfactor</a>[i].<a class="code" href="structManyBodyOperator.html#a05268b1b149040fd992263f2e22de7ec">par</a> = par;
    <a class="code" href="Formfactors_8c.html#ae9b23ef5773aed752a74d4f815eb992d">OpMultipoleFormfactor</a>[i].<a class="code" href="structManyBodyOperator.html#aba2e7e550190ee2ec6e75c23c55fee2d">me</a> = NULL;
  }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a17b425ec175de4ce746eacdc2f054b24"></a><!-- doxytag: member="Formfactors.c::writeChargeDensities" ref="a17b425ec175de4ce746eacdc2f054b24" args="(FILE *fp, const Projection *P, const FormfactorPara *p, double rmax, int npointsr, int Z, int l, int j, int pi, int a, void *ffactorme, const Eigenstates *E)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeChargeDensities </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structProjection.html">Projection</a> *&nbsp;</td>
          <td class="paramname"> <em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>rmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>npointsr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>Z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ffactorme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structEigenstates.html">Eigenstates</a> *&nbsp;</td>
          <td class="paramname"> <em>E</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00470">470</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>References <a class="el" href="sphericalbessel_8c_source.html#l00027">besselj0()</a>, <a class="el" href="physics_8c_source.html#l00112">fneutron()</a>, <a class="el" href="physics_8c_source.html#l00101">fproton()</a>, <a class="el" href="Projection_8h_source.html#l00147">Eigenstates::index</a>, <a class="el" href="Projection_8h_source.html#l00093">Projection::jmax</a>, <a class="el" href="Projection_8h_source.html#l00148">Eigenstates::norm</a>, <a class="el" href="Formfactors_8h_source.html#l00027">FormfactorPara::npoints</a>, <a class="el" href="Formfactors_8h_source.html#l00026">FormfactorPara::qmax</a>, <a class="el" href="ProjectedDensityMatrixHO_8c_source.html#l00065">rho</a>, and <a class="el" href="calcbasisovlapmulti_8c_source.html#l00032">SQR</a>.</p>

<p>Referenced by <a class="el" href="calcchargedensities_8c_source.html#l00029">main()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> jmax = P-&gt;<a class="code" href="structProjection.html#aaab8cf237ff5e23d0f7abb05117387fe" title="calculate up to (jmax-1)/2">jmax</a>;
  <span class="keywordtype">int</span> ipj = idxpij(jmax,pi,<a class="code" href="MinimizerDONLP2multivapp_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>);
  <span class="keywordtype">int</span> npoints = p-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
  <span class="keywordtype">double</span> qmax = p-&gt;<a class="code" href="structFormfactorPara.html#a1e3e2bcd9f63c49e819a5916614673e1">qmax</a>;
  <span class="keywordtype">int</span> idx = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipj][a];
  complex <span class="keywordtype">double</span> norm = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipj][idx];
  complex double (**ffctme)[2*npoints] = ffactorme;
  complex double (*ff)[npoints] = ffctme[ipj][idx];
  <span class="keywordtype">double</span> anu[npoints];

  <span class="keywordtype">int</span> i, nu;
  <span class="keywordtype">double</span> qnu[npoints];
  <span class="keywordtype">double</span> Rc = M_PI*(npoints-1)/qmax;

  <span class="keywordflow">if</span> (<a class="code" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a> != 0) {
    fprintf(stderr, <span class="stringliteral">&quot;writeChargeDensities not yet implemented for l != 0\n&quot;</span>);
    exit(-1);
  }

  <span class="comment">// calculate coefficients anu</span>
  <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++) {
    qnu[nu] = M_PI*nu/Rc;
    anu[nu] = 1/sqrt(4*M_PI)*<a class="code" href="calcbasisovlapmulti_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(qnu[nu])/(2*M_PI*Rc)*
      (ff[0][nu]*<a class="code" href="physics_8c.html#ae2b9a725d285683c6ebccec5b8fb5d4c">fproton</a>(qnu[nu])+ff[1][nu]*<a class="code" href="physics_8c.html#a7739fcc8d2b58be4799956cfcae01c6e">fneutron</a>(qnu[nu]))/norm;
  }

  <span class="comment">// calculate densities </span>
      
  <span class="keywordtype">double</span> deltar=rmax/(npointsr-1);
  <span class="keywordtype">double</span> <a class="code" href="ProjectedDensityMatrixHO_8c.html#a103956ea26133e0b04f20e47636c5f03">rho</a>;

  <span class="comment">// charge densities</span>
  <span class="keywordflow">for</span> (i=0; i&lt;npointsr; i++) {
    rho = 0.0; 
    <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++)
      rho += anu[nu]*<a class="code" href="sphericalbessel_8c.html#ac0cec34703d518b21b372ea6e6bc3cef">besselj0</a>(qnu[nu]*i*deltar);
    fprintf(fp, <span class="stringliteral">&quot;%6.3f\t%15.8g\n&quot;</span>, i*deltar, rho);
  }
}  
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae39dd2947271bd127bb37eaf2b1d100f"></a><!-- doxytag: member="Formfactors.c::writeChargeFormfactors" ref="ae39dd2947271bd127bb37eaf2b1d100f" args="(FILE *fp, const Projection *P, const FormfactorPara *p, int l, int j, int pi, int a, void *ffactorme, const Eigenstates *E)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeChargeFormfactors </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structProjection.html">Projection</a> *&nbsp;</td>
          <td class="paramname"> <em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ffactorme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structEigenstates.html">Eigenstates</a> *&nbsp;</td>
          <td class="paramname"> <em>E</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00221">221</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>References <a class="el" href="physics_8c_source.html#l00112">fneutron()</a>, <a class="el" href="physics_8c_source.html#l00101">fproton()</a>, <a class="el" href="Projection_8h_source.html#l00147">Eigenstates::index</a>, <a class="el" href="Projection_8h_source.html#l00093">Projection::jmax</a>, <a class="el" href="Projection_8h_source.html#l00148">Eigenstates::norm</a>, <a class="el" href="Formfactors_8h_source.html#l00027">FormfactorPara::npoints</a>, and <a class="el" href="Formfactors_8h_source.html#l00026">FormfactorPara::qmax</a>.</p>

<p>Referenced by <a class="el" href="calcchargeformfactors_8c_source.html#l00029">main()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> jmax = P-&gt;<a class="code" href="structProjection.html#aaab8cf237ff5e23d0f7abb05117387fe" title="calculate up to (jmax-1)/2">jmax</a>;
  <span class="keywordtype">int</span> ipj = idxpij(jmax,pi,<a class="code" href="MinimizerDONLP2multivapp_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>);
  <span class="keywordtype">int</span> npoints = p-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
  <span class="keywordtype">double</span> qmax = p-&gt;<a class="code" href="structFormfactorPara.html#a1e3e2bcd9f63c49e819a5916614673e1">qmax</a>;
  <span class="keywordtype">int</span> idx = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipj][a];
  <span class="keywordtype">double</span> norm = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipj][idx];
  complex double (**ffctme)[2*npoints] = ffactorme;
  complex double (*ff)[npoints] = ffctme[ipj][idx];
  <span class="keywordtype">int</span> i;
  <span class="keywordtype">double</span> <a class="code" href="MinimizerDONLP2_8c.html#a116d67c73cdfa395275c96c0151ddcd4">q</a>;
  <span class="keywordtype">double</span> ml;
  
  <span class="keywordflow">for</span> (i=0; i&lt;npoints; i++) {
    q = qmax*i/(npoints-1);
    
    ml = creal((ff[0][i]*<a class="code" href="physics_8c.html#ae2b9a725d285683c6ebccec5b8fb5d4c">fproton</a>(q) + ff[1][i]*<a class="code" href="physics_8c.html#a7739fcc8d2b58be4799956cfcae01c6e">fneutron</a>(q))/norm);    

    fprintf(fp, <span class="stringliteral">&quot;%6.3f\t%13.5g\n&quot;</span>, q, sqrt(<a class="code" href="MinimizerDONLP2multivapp_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>+1.0)*ml);
  }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a89efe28c922813f3699a6633da4da252"></a><!-- doxytag: member="Formfactors.c::writeChargeFourierBessel" ref="a89efe28c922813f3699a6633da4da252" args="(FILE *fp, const Projection *P, const FormfactorPara *p, double rmax, int npointsr, int Z, int l, int j, int pi, int a, void *ffactorme, const Eigenstates *E)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeChargeFourierBessel </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structProjection.html">Projection</a> *&nbsp;</td>
          <td class="paramname"> <em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>rmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>npointsr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>Z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ffactorme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structEigenstates.html">Eigenstates</a> *&nbsp;</td>
          <td class="paramname"> <em>E</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00520">520</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>References <a class="el" href="physics_8c_source.html#l00112">fneutron()</a>, <a class="el" href="physics_8c_source.html#l00101">fproton()</a>, <a class="el" href="Projection_8h_source.html#l00147">Eigenstates::index</a>, <a class="el" href="Projection_8h_source.html#l00093">Projection::jmax</a>, <a class="el" href="Projection_8h_source.html#l00148">Eigenstates::norm</a>, <a class="el" href="Formfactors_8h_source.html#l00027">FormfactorPara::npoints</a>, <a class="el" href="Formfactors_8h_source.html#l00026">FormfactorPara::qmax</a>, and <a class="el" href="calcbasisovlapmulti_8c_source.html#l00032">SQR</a>.</p>

<p>Referenced by <a class="el" href="calcchargedensities_8c_source.html#l00029">main()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> jmax = P-&gt;<a class="code" href="structProjection.html#aaab8cf237ff5e23d0f7abb05117387fe" title="calculate up to (jmax-1)/2">jmax</a>;
  <span class="keywordtype">int</span> ipj = idxpij(jmax,pi,<a class="code" href="MinimizerDONLP2multivapp_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>);
  <span class="keywordtype">int</span> npoints = p-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
  <span class="keywordtype">double</span> qmax = p-&gt;<a class="code" href="structFormfactorPara.html#a1e3e2bcd9f63c49e819a5916614673e1">qmax</a>;
  <span class="keywordtype">int</span> idx = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipj][a];
  complex <span class="keywordtype">double</span> norm = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipj][idx];
  complex double (**ffctme)[2*npoints] = ffactorme;
  complex double (*ff)[npoints] = ffctme[ipj][idx];
  <span class="keywordtype">double</span> anu[npoints];

  <span class="keywordtype">int</span> nu;
  <span class="keywordtype">double</span> qnu[npoints];
  <span class="keywordtype">double</span> Rc = M_PI*(npoints-1)/qmax;

  <span class="keywordflow">if</span> (<a class="code" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a> != 0) {
    fprintf(stderr, <span class="stringliteral">&quot;writeChargeFourierBessel not yet implemented for l != 0\n&quot;</span>);
    exit(-1);
  }

  <span class="comment">// calculate coefficients anu</span>
  <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++) {
    qnu[nu] = M_PI*nu/Rc;
    anu[nu] = 1/sqrt(4*M_PI)*<a class="code" href="calcbasisovlapmulti_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(qnu[nu])/(2*M_PI*Rc)*
      (ff[0][nu]*<a class="code" href="physics_8c.html#ae2b9a725d285683c6ebccec5b8fb5d4c">fproton</a>(qnu[nu])+ff[1][nu]*<a class="code" href="physics_8c.html#a7739fcc8d2b58be4799956cfcae01c6e">fneutron</a>(qnu[nu]))/norm;
  }

  <span class="comment">// write fourier bessel coefficients</span>

  fprintf(fp, <span class="stringliteral">&quot;# Rc      = %8.3f\n&quot;</span>, Rc);
  fprintf(fp, <span class="stringliteral">&quot;# qmax    = %8.3f\n&quot;</span>, qmax);
  fprintf(fp, <span class="stringliteral">&quot;# npoints = %d\n&quot;</span>, npoints-1);

  fprintf(fp, <span class="stringliteral">&quot;\n#nu\tq[nu]\ta[nu]\n&quot;</span>);

  <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++)
    fprintf(fp, <span class="stringliteral">&quot;%d\t%8.3f\t%15.8g\n&quot;</span>, nu, qnu[nu], anu[nu]);

}  
</pre></div></p>

</div>
</div>
<a class="anchor" id="accfbeb77b13941ef885f61391b0153cb"></a><!-- doxytag: member="Formfactors.c::writeMatterDensities" ref="accfbeb77b13941ef885f61391b0153cb" args="(FILE *fp, const Projection *P, const FormfactorPara *p, double rmax, int npointsr, int A, int l, int j, int pi, int a, void *ffactorme, const Eigenstates *E)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeMatterDensities </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structProjection.html">Projection</a> *&nbsp;</td>
          <td class="paramname"> <em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>rmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>npointsr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ffactorme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structEigenstates.html">Eigenstates</a> *&nbsp;</td>
          <td class="paramname"> <em>E</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00410">410</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>References <a class="el" href="sphericalbessel_8c_source.html#l00027">besselj0()</a>, <a class="el" href="physics_8c_source.html#l00101">fproton()</a>, <a class="el" href="Projection_8h_source.html#l00147">Eigenstates::index</a>, <a class="el" href="Projection_8h_source.html#l00093">Projection::jmax</a>, <a class="el" href="Projection_8h_source.html#l00148">Eigenstates::norm</a>, <a class="el" href="Formfactors_8h_source.html#l00027">FormfactorPara::npoints</a>, <a class="el" href="Formfactors_8h_source.html#l00026">FormfactorPara::qmax</a>, <a class="el" href="ProjectedDensityMatrixHO_8c_source.html#l00065">rho</a>, and <a class="el" href="calcbasisovlapmulti_8c_source.html#l00032">SQR</a>.</p>

<p>Referenced by <a class="el" href="calcmatterdensities_8c_source.html#l00030">main()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> jmax = P-&gt;<a class="code" href="structProjection.html#aaab8cf237ff5e23d0f7abb05117387fe" title="calculate up to (jmax-1)/2">jmax</a>;
  <span class="keywordtype">int</span> ipj = idxpij(jmax,pi,<a class="code" href="MinimizerDONLP2multivapp_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>);
  <span class="keywordtype">int</span> npoints = p-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
  <span class="keywordtype">double</span> qmax = p-&gt;<a class="code" href="structFormfactorPara.html#a1e3e2bcd9f63c49e819a5916614673e1">qmax</a>;
  <span class="keywordtype">int</span> idx = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipj][a];
  complex <span class="keywordtype">double</span> norm = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipj][idx];
  complex double (**ffctme)[2*npoints] = ffactorme;
  complex double (*ff)[npoints] = ffctme[ipj][idx];
  complex <span class="keywordtype">double</span> anu[npoints][2];

  <span class="keywordtype">int</span> i, nu;
  <span class="keywordtype">double</span> qnu[npoints];
  <span class="keywordtype">double</span> Rc = M_PI*(npoints-1)/qmax;

  <span class="keywordflow">if</span> (<a class="code" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a> != 0) {
    fprintf(stderr, <span class="stringliteral">&quot;writeMatterDensities not yet implemented for l != 0\n&quot;</span>);
    exit(-1);
  }

  <span class="comment">// calculate coefficients anu</span>
  <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++) {
    qnu[nu] = M_PI*nu/Rc;
    anu[nu][0] = 1/sqrt(4*M_PI)*<a class="code" href="calcbasisovlapmulti_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(qnu[nu])/(2*M_PI*Rc)*ff[0][nu]*<a class="code" href="physics_8c.html#ae2b9a725d285683c6ebccec5b8fb5d4c">fproton</a>(qnu[nu])/norm;
    anu[nu][1] = 1/sqrt(4*M_PI)*<a class="code" href="calcbasisovlapmulti_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(qnu[nu])/(2*M_PI*Rc)*ff[1][nu]*<a class="code" href="physics_8c.html#ae2b9a725d285683c6ebccec5b8fb5d4c">fproton</a>(qnu[nu])/norm;
  }

  <span class="comment">// calculate densities </span>
      
  <span class="keywordtype">double</span> deltar=rmax/(npointsr-1);
  <span class="keywordtype">double</span> <a class="code" href="ProjectedDensityMatrixHO_8c.html#a103956ea26133e0b04f20e47636c5f03">rho</a>, rhop, rhon;

  <span class="keywordflow">for</span> (i=0; i&lt;npointsr; i++) {

    rho = 0.0; 
    <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++)
      rho += (anu[nu][0]+anu[nu][1])*<a class="code" href="sphericalbessel_8c.html#ac0cec34703d518b21b372ea6e6bc3cef">besselj0</a>(qnu[nu]*i*deltar);

    rhop = 0.0;
    <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++)
      rhop += anu[nu][0]* <a class="code" href="sphericalbessel_8c.html#ac0cec34703d518b21b372ea6e6bc3cef">besselj0</a>(qnu[nu]*i*deltar);

    rhon = 0.0;
    <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++)
      rhon += anu[nu][1]* <a class="code" href="sphericalbessel_8c.html#ac0cec34703d518b21b372ea6e6bc3cef">besselj0</a>(qnu[nu]*i*deltar);

    fprintf(fp, <span class="stringliteral">&quot;%6.3f\t%15.8g\t%15.8g\t%15.8g\n&quot;</span>, 
            i*deltar, rho, rhop, rhon);
  }
}  
</pre></div></p>

</div>
</div>
<a class="anchor" id="a66ef1a04e19407e0fe6b0ef8ba880102"></a><!-- doxytag: member="Formfactors.c::writePointDensities" ref="a66ef1a04e19407e0fe6b0ef8ba880102" args="(FILE *fp, const Projection *P, const FormfactorPara *p, double rmax, int npointsr, int A, int l, int j, int pi, int a, void *ffactorme, const Eigenstates *E)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writePointDensities </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structProjection.html">Projection</a> *&nbsp;</td>
          <td class="paramname"> <em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>rmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>npointsr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ffactorme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structEigenstates.html">Eigenstates</a> *&nbsp;</td>
          <td class="paramname"> <em>E</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00348">348</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>References <a class="el" href="sphericalbessel_8c_source.html#l00027">besselj0()</a>, <a class="el" href="Projection_8h_source.html#l00147">Eigenstates::index</a>, <a class="el" href="Projection_8h_source.html#l00093">Projection::jmax</a>, <a class="el" href="Projection_8h_source.html#l00148">Eigenstates::norm</a>, <a class="el" href="Formfactors_8h_source.html#l00027">FormfactorPara::npoints</a>, <a class="el" href="Formfactors_8h_source.html#l00026">FormfactorPara::qmax</a>, <a class="el" href="ProjectedDensityMatrixHO_8c_source.html#l00065">rho</a>, and <a class="el" href="calcbasisovlapmulti_8c_source.html#l00032">SQR</a>.</p>

<p>Referenced by <a class="el" href="calcpointdensities_8c_source.html#l00029">main()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> jmax = P-&gt;<a class="code" href="structProjection.html#aaab8cf237ff5e23d0f7abb05117387fe" title="calculate up to (jmax-1)/2">jmax</a>;
  <span class="keywordtype">int</span> ipj = idxpij(jmax,pi,<a class="code" href="MinimizerDONLP2multivapp_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>);
  <span class="keywordtype">int</span> npoints = p-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
  <span class="keywordtype">double</span> qmax = p-&gt;<a class="code" href="structFormfactorPara.html#a1e3e2bcd9f63c49e819a5916614673e1">qmax</a>;
  <span class="keywordtype">int</span> idx = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipj][a];
  complex <span class="keywordtype">double</span> norm = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipj][idx];
  complex double (**ffctme)[2*npoints] = ffactorme;
  complex double (*ff)[npoints] = ffctme[ipj][idx];
  complex <span class="keywordtype">double</span> anu[npoints][2];

  <span class="keywordtype">int</span> i, nu;
  <span class="keywordtype">double</span> qnu[npoints];
  <span class="keywordtype">double</span> Rc = M_PI*(npoints-1)/qmax;

  <span class="keywordflow">if</span> (<a class="code" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a> != 0) {
    fprintf(stderr, <span class="stringliteral">&quot;writePointDensities not yet implemented for l != 0\n&quot;</span>);
    exit(-1);
  }

  <span class="comment">// calculate coefficients anu</span>
  <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++) {
    qnu[nu] = M_PI*nu/Rc;
    anu[nu][0] = 1/sqrt(4*M_PI)*<a class="code" href="calcbasisovlapmulti_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(qnu[nu])/(2*M_PI*Rc)*ff[0][nu]/norm;
    anu[nu][1] = 1/sqrt(4*M_PI)*<a class="code" href="calcbasisovlapmulti_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(qnu[nu])/(2*M_PI*Rc)*ff[1][nu]/norm;
  }

  <span class="comment">// calculate densities </span>
      
  <span class="keywordtype">double</span> deltar=rmax/(npointsr-1);
  <span class="keywordtype">double</span> <a class="code" href="ProjectedDensityMatrixHO_8c.html#a103956ea26133e0b04f20e47636c5f03">rho</a>, rhop, rhon;

  <span class="keywordflow">for</span> (i=0; i&lt;npointsr; i++) {

    rho = 0.0; 
    <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++)
      rho += (anu[nu][0]+anu[nu][1])*<a class="code" href="sphericalbessel_8c.html#ac0cec34703d518b21b372ea6e6bc3cef">besselj0</a>(qnu[nu]*i*deltar);

    rhop = 0.0;
    <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++)
      rhop += anu[nu][0]* <a class="code" href="sphericalbessel_8c.html#ac0cec34703d518b21b372ea6e6bc3cef">besselj0</a>(qnu[nu]*i*deltar);

    rhon = 0.0;
    <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++)
      rhon += anu[nu][1]* <a class="code" href="sphericalbessel_8c.html#ac0cec34703d518b21b372ea6e6bc3cef">besselj0</a>(qnu[nu]*i*deltar);

    fprintf(fp, <span class="stringliteral">&quot;%6.3f\t%15.8g\t%15.8g\t%15.8g\n&quot;</span>, 
            i*deltar, rho, rhop, rhon);
  }
}  
</pre></div></p>

</div>
</div>
<a class="anchor" id="a81e93d93df8e3d7ab71144f2d011fcc3"></a><!-- doxytag: member="Formfactors.c::writePointFormfactors" ref="a81e93d93df8e3d7ab71144f2d011fcc3" args="(FILE *fp, const Projection *P, const FormfactorPara *p, int l, int j, int pi, int a, void *ffactorme, const Eigenstates *E)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writePointFormfactors </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structProjection.html">Projection</a> *&nbsp;</td>
          <td class="paramname"> <em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ffactorme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structEigenstates.html">Eigenstates</a> *&nbsp;</td>
          <td class="paramname"> <em>E</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00187">187</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>References <a class="el" href="Projection_8h_source.html#l00147">Eigenstates::index</a>, <a class="el" href="Projection_8h_source.html#l00093">Projection::jmax</a>, <a class="el" href="Projection_8h_source.html#l00148">Eigenstates::norm</a>, <a class="el" href="Formfactors_8h_source.html#l00027">FormfactorPara::npoints</a>, and <a class="el" href="Formfactors_8h_source.html#l00026">FormfactorPara::qmax</a>.</p>

<p>Referenced by <a class="el" href="calcpointformfactors_8c_source.html#l00029">main()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> jmax = P-&gt;<a class="code" href="structProjection.html#aaab8cf237ff5e23d0f7abb05117387fe" title="calculate up to (jmax-1)/2">jmax</a>;
  <span class="keywordtype">int</span> ipj = idxpij(jmax,pi,<a class="code" href="MinimizerDONLP2multivapp_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>);
  <span class="keywordtype">int</span> npoints = p-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
  <span class="keywordtype">double</span> qmax = p-&gt;<a class="code" href="structFormfactorPara.html#a1e3e2bcd9f63c49e819a5916614673e1">qmax</a>;
  <span class="keywordtype">int</span> idx = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipj][a];
  complex <span class="keywordtype">double</span> norm = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipj][idx];
  complex double (**ffctme)[2*npoints] = ffactorme;
  complex double (*ff)[npoints] = ffctme[ipj][idx];
  <span class="keywordtype">int</span> i;
  <span class="keywordtype">double</span> <a class="code" href="MinimizerDONLP2_8c.html#a116d67c73cdfa395275c96c0151ddcd4">q</a>, ml, mlp, mln;
  
  <span class="keywordflow">for</span> (i=0; i&lt;npoints; i++) {
    q = qmax*i/(npoints-1);
    mlp = ff[0][i]/norm;
    mln = ff[1][i]/norm;
    ml = (ff[0][i]+ff[1][i])/norm;

    fprintf(fp, <span class="stringliteral">&quot;%6.3f\t%13.8g\t%13.8g\t%13.8g\n&quot;</span>,
            q,
            sqrt(<a class="code" href="MinimizerDONLP2multivapp_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>+1.0)*ml,
            sqrt(<a class="code" href="MinimizerDONLP2multivapp_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>+1.0)*mlp,
            sqrt(<a class="code" href="MinimizerDONLP2multivapp_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>+1.0)*mln);
  }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a64298611e7dd254daf375af9f29b5258"></a><!-- doxytag: member="Formfactors.c::writeTransitionChargeDensities" ref="a64298611e7dd254daf375af9f29b5258" args="(FILE *fp, const Projection *P, const FormfactorPara *p, double rmax, int npointsr, int Z, int l, int jfin, int pfin, int afin, int jini, int pini, int aini, void *ffactorme, const Eigenstates *E)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeTransitionChargeDensities </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structProjection.html">Projection</a> *&nbsp;</td>
          <td class="paramname"> <em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>rmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>npointsr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>Z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>jfin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pfin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>afin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>jini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>aini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ffactorme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structEigenstates.html">Eigenstates</a> *&nbsp;</td>
          <td class="paramname"> <em>E</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00645">645</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>References <a class="el" href="sphericalbessel_8c_source.html#l00027">besselj0()</a>, <a class="el" href="physics_8c_source.html#l00112">fneutron()</a>, <a class="el" href="physics_8c_source.html#l00101">fproton()</a>, <a class="el" href="MinimizerDONLP2orthogonalvapp_8c_source.html#l00108">ifix</a>, <a class="el" href="Projection_8h_source.html#l00147">Eigenstates::index</a>, <a class="el" href="Projection_8h_source.html#l00093">Projection::jmax</a>, <a class="el" href="Projection_8h_source.html#l00148">Eigenstates::norm</a>, <a class="el" href="Formfactors_8h_source.html#l00027">FormfactorPara::npoints</a>, <a class="el" href="donlp2_8h_source.html#l00117">phase</a>, <a class="el" href="Formfactors_8h_source.html#l00026">FormfactorPara::qmax</a>, <a class="el" href="ProjectedDensityMatrixHO_8c_source.html#l00065">rho</a>, and <a class="el" href="calcbasisovlapmulti_8c_source.html#l00032">SQR</a>.</p>

<p>Referenced by <a class="el" href="calctransitionchargedensities_8c_source.html#l00029">main()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> jmax = P-&gt;<a class="code" href="structProjection.html#aaab8cf237ff5e23d0f7abb05117387fe" title="calculate up to (jmax-1)/2">jmax</a>;
  <span class="keywordtype">int</span> ipjini = idxpij(jmax,pini,jini);
  <span class="keywordtype">int</span> ipjfin = idxpij(jmax,pfin,jfin);
  <span class="keywordtype">int</span> npoints = p-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
  <span class="keywordtype">double</span> qmax = p-&gt;<a class="code" href="structFormfactorPara.html#a1e3e2bcd9f63c49e819a5916614673e1">qmax</a>;
  <span class="keywordtype">int</span> idxfin = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipjfin][afin];
  <span class="keywordtype">int</span> idxini = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipjini][aini];
  <span class="keywordtype">double</span> normfin = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipjfin][idxfin];
  <span class="keywordtype">double</span> normini = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipjini][idxini];
  complex double (****ffctme)[2*npoints] = ffactorme;
  complex double (*ff)[npoints] = 
    ffctme[ipjfin][ipjini][idxfin][idxini];
  complex <span class="keywordtype">double</span> anu[npoints];

  <span class="keywordtype">int</span> i, nu;
  complex <span class="keywordtype">double</span> ff0, <a class="code" href="donlp2_8h.html#accf3aec63bc20b3c99ab4881cb07c05b">phase</a>;
  <span class="keywordtype">double</span> qnu[npoints];
  <span class="keywordtype">double</span> Rc = M_PI*(npoints-1)/qmax;

  <span class="keywordflow">if</span> (<a class="code" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a> != 0) {
    fprintf(stderr, <span class="stringliteral">&quot;writeChargeDensities not yet implemented for l != 0\n&quot;</span>);
    exit(-1);
  }

  <span class="comment">// get rid of possible phase factor</span>

  <span class="keywordtype">int</span> <a class="code" href="MinimizerDONLP2orthogonalvapp_8c.html#a25b7899372667d4f2f54730eae52607e">ifix</a>=npoints/3;
  <span class="keywordtype">double</span> qfix=qmax*ifix/(npoints-1);

  ff0 = ff[0][ifix]*<a class="code" href="physics_8c.html#ae2b9a725d285683c6ebccec5b8fb5d4c">fproton</a>(qfix)+ff[1][ifix]*<a class="code" href="physics_8c.html#a7739fcc8d2b58be4799956cfcae01c6e">fneutron</a>(qfix);
  phase = ff0/cabs(ff0);

  <span class="comment">// calculate coefficients anu</span>
  <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++) {
    qnu[nu] = M_PI*nu/Rc;
    anu[nu] = 1/sqrt(4*M_PI)*<a class="code" href="calcbasisovlapmulti_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(qnu[nu])/(2*M_PI*Rc)*
      creal((ff[0][nu]*<a class="code" href="physics_8c.html#ae2b9a725d285683c6ebccec5b8fb5d4c">fproton</a>(qnu[nu])+ff[1][nu]*<a class="code" href="physics_8c.html#a7739fcc8d2b58be4799956cfcae01c6e">fneutron</a>(qnu[nu]))/phase)/
      sqrt(normfin*normini);
  }

  <span class="comment">// calculate densities </span>
      
  <span class="keywordtype">double</span> deltar=rmax/(npointsr-1);
  <span class="keywordtype">double</span> <a class="code" href="ProjectedDensityMatrixHO_8c.html#a103956ea26133e0b04f20e47636c5f03">rho</a>;

  <span class="comment">// charge densities</span>
  <span class="keywordflow">for</span> (i=0; i&lt;npointsr; i++) {
    rho = 0.0; 
    <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++)
      rho += anu[nu]*<a class="code" href="sphericalbessel_8c.html#ac0cec34703d518b21b372ea6e6bc3cef">besselj0</a>(qnu[nu]*i*deltar);

    fprintf(fp, <span class="stringliteral">&quot;%6.3f\t%15.8g\n&quot;</span>, i*deltar, rho);
  }
}  
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4866d0d52658593657bb329703db48a2"></a><!-- doxytag: member="Formfactors.c::writeTransitionChargeFormfactors" ref="a4866d0d52658593657bb329703db48a2" args="(FILE *fp, const Projection *P, const FormfactorPara *p, int l, int jfin, int pfin, int afin, int jini, int pini, int aini, void *ffactorme, const Eigenstates *E)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeTransitionChargeFormfactors </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structProjection.html">Projection</a> *&nbsp;</td>
          <td class="paramname"> <em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>jfin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pfin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>afin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>jini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>aini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ffactorme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structEigenstates.html">Eigenstates</a> *&nbsp;</td>
          <td class="paramname"> <em>E</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00302">302</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>References <a class="el" href="physics_8c_source.html#l00112">fneutron()</a>, <a class="el" href="physics_8c_source.html#l00101">fproton()</a>, <a class="el" href="MinimizerDONLP2orthogonalvapp_8c_source.html#l00108">ifix</a>, <a class="el" href="Projection_8h_source.html#l00147">Eigenstates::index</a>, <a class="el" href="Projection_8h_source.html#l00093">Projection::jmax</a>, <a class="el" href="Projection_8h_source.html#l00148">Eigenstates::norm</a>, <a class="el" href="Formfactors_8h_source.html#l00027">FormfactorPara::npoints</a>, <a class="el" href="donlp2_8h_source.html#l00117">phase</a>, and <a class="el" href="Formfactors_8h_source.html#l00026">FormfactorPara::qmax</a>.</p>

<p>Referenced by <a class="el" href="calctransitionchargeformfactors_8c_source.html#l00029">main()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> jmax = P-&gt;<a class="code" href="structProjection.html#aaab8cf237ff5e23d0f7abb05117387fe" title="calculate up to (jmax-1)/2">jmax</a>;
  <span class="keywordtype">int</span> ipjfin = idxpij(jmax,pfin,jfin);
  <span class="keywordtype">int</span> ipjini = idxpij(jmax,pini,jini);
  <span class="keywordtype">int</span> npoints = p-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
  <span class="keywordtype">double</span> qmax = p-&gt;<a class="code" href="structFormfactorPara.html#a1e3e2bcd9f63c49e819a5916614673e1">qmax</a>;
  <span class="keywordtype">int</span> idxfin = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipjfin][afin];
  <span class="keywordtype">int</span> idxini = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipjini][aini];
  <span class="keywordtype">double</span> normfin = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipjfin][idxfin];
  <span class="keywordtype">double</span> normini = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipjini][idxini];
  complex double (****ffctme)[2*npoints] = ffactorme;
  complex double (*ff)[npoints] = 
    ffctme[ipjfin][ipjini][idxfin][idxini];
  <span class="keywordtype">int</span> i;
  <span class="keywordtype">double</span> <a class="code" href="MinimizerDONLP2_8c.html#a116d67c73cdfa395275c96c0151ddcd4">q</a>;
  <span class="keywordtype">double</span> ml;
  complex <span class="keywordtype">double</span> ff0, <a class="code" href="donlp2_8h.html#accf3aec63bc20b3c99ab4881cb07c05b">phase</a>;
  
  <span class="comment">// get rid of possible phase factors</span>
  <span class="comment">// formfactor should be real and positive for q=0</span>
  
  <span class="keywordtype">int</span> <a class="code" href="MinimizerDONLP2orthogonalvapp_8c.html#a25b7899372667d4f2f54730eae52607e">ifix</a>=npoints/3;
  <span class="keywordtype">double</span> qfix=qmax*ifix/(npoints-1);

  ff0 = ff[0][ifix]*<a class="code" href="physics_8c.html#ae2b9a725d285683c6ebccec5b8fb5d4c">fproton</a>(qfix)+ff[1][ifix]*<a class="code" href="physics_8c.html#a7739fcc8d2b58be4799956cfcae01c6e">fneutron</a>(qfix);
  phase = ff0/cabs(ff0);

  <span class="keywordflow">for</span> (i=0; i&lt;npoints; i++) {
    q = qmax*i/(npoints-1);
    
    ml = creal((ff[0][i]*<a class="code" href="physics_8c.html#ae2b9a725d285683c6ebccec5b8fb5d4c">fproton</a>(q) + ff[1][i]*<a class="code" href="physics_8c.html#a7739fcc8d2b58be4799956cfcae01c6e">fneutron</a>(q))/phase)/
      sqrt(normfin*normini);

    fprintf(fp, <span class="stringliteral">&quot;%6.3f\t%13.5g\n&quot;</span>, q, sqrt(jfin+1)*ml);
  }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="afb73a957aa0d7094666a6e42c78e3968"></a><!-- doxytag: member="Formfactors.c::writeTransitionChargeFourierBessel" ref="afb73a957aa0d7094666a6e42c78e3968" args="(FILE *fp, const Projection *P, const FormfactorPara *p, double rmax, int npointsr, int Z, int l, int jfin, int pfin, int afin, int jini, int pini, int aini, void *ffactorme, const Eigenstates *E)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeTransitionChargeFourierBessel </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structProjection.html">Projection</a> *&nbsp;</td>
          <td class="paramname"> <em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>rmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>npointsr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>Z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>jfin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pfin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>afin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>jini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>aini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ffactorme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structEigenstates.html">Eigenstates</a> *&nbsp;</td>
          <td class="paramname"> <em>E</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00711">711</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>References <a class="el" href="physics_8c_source.html#l00112">fneutron()</a>, <a class="el" href="physics_8c_source.html#l00101">fproton()</a>, <a class="el" href="MinimizerDONLP2orthogonalvapp_8c_source.html#l00108">ifix</a>, <a class="el" href="Projection_8h_source.html#l00147">Eigenstates::index</a>, <a class="el" href="Projection_8h_source.html#l00093">Projection::jmax</a>, <a class="el" href="Projection_8h_source.html#l00148">Eigenstates::norm</a>, <a class="el" href="Formfactors_8h_source.html#l00027">FormfactorPara::npoints</a>, <a class="el" href="donlp2_8h_source.html#l00117">phase</a>, <a class="el" href="Formfactors_8h_source.html#l00026">FormfactorPara::qmax</a>, and <a class="el" href="calcbasisovlapmulti_8c_source.html#l00032">SQR</a>.</p>

<p>Referenced by <a class="el" href="calctransitionchargedensities_8c_source.html#l00029">main()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> jmax = P-&gt;<a class="code" href="structProjection.html#aaab8cf237ff5e23d0f7abb05117387fe" title="calculate up to (jmax-1)/2">jmax</a>;
  <span class="keywordtype">int</span> ipjini = idxpij(jmax,pini,jini);
  <span class="keywordtype">int</span> ipjfin = idxpij(jmax,pfin,jfin);
  <span class="keywordtype">int</span> npoints = p-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
  <span class="keywordtype">double</span> qmax = p-&gt;<a class="code" href="structFormfactorPara.html#a1e3e2bcd9f63c49e819a5916614673e1">qmax</a>;
  <span class="keywordtype">int</span> idxfin = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipjfin][afin];
  <span class="keywordtype">int</span> idxini = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipjini][aini];
  <span class="keywordtype">double</span> normfin = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipjfin][idxfin];
  <span class="keywordtype">double</span> normini = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipjini][idxini];
  complex double (****ffctme)[2*npoints] = ffactorme;
  complex double (*ff)[npoints] = 
    ffctme[ipjfin][ipjini][idxfin][idxini];
  <span class="keywordtype">double</span> anu[npoints];

  <span class="keywordtype">int</span> nu;
  complex <span class="keywordtype">double</span> ff0, <a class="code" href="donlp2_8h.html#accf3aec63bc20b3c99ab4881cb07c05b">phase</a>;
  <span class="keywordtype">double</span> qnu[npoints];
  <span class="keywordtype">double</span> Rc = M_PI*(npoints-1)/qmax;

  <span class="keywordflow">if</span> (<a class="code" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a> != 0) {
    fprintf(stderr, <span class="stringliteral">&quot;writeChargeDensities not yet implemented for l != 0\n&quot;</span>);
    exit(-1);
  }

  <span class="comment">// get rid of possible phase factor</span>

  <span class="keywordtype">int</span> <a class="code" href="MinimizerDONLP2orthogonalvapp_8c.html#a25b7899372667d4f2f54730eae52607e">ifix</a>=npoints/3;
  <span class="keywordtype">double</span> qfix=qmax*ifix/(npoints-1);

  ff0 = ff[0][ifix]*<a class="code" href="physics_8c.html#ae2b9a725d285683c6ebccec5b8fb5d4c">fproton</a>(qfix)+ff[1][ifix]*<a class="code" href="physics_8c.html#a7739fcc8d2b58be4799956cfcae01c6e">fneutron</a>(qfix);
  phase = ff0/cabs(ff0);

  <span class="comment">// calculate coefficients anu</span>
  <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++) {
    qnu[nu] = M_PI*nu/Rc;
    anu[nu] = 1/sqrt(4*M_PI)*<a class="code" href="calcbasisovlapmulti_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(qnu[nu])/(2*M_PI*Rc)*
      creal((ff[0][nu]*<a class="code" href="physics_8c.html#ae2b9a725d285683c6ebccec5b8fb5d4c">fproton</a>(qnu[nu])+ff[1][nu]*<a class="code" href="physics_8c.html#a7739fcc8d2b58be4799956cfcae01c6e">fneutron</a>(qnu[nu]))/phase)/
      sqrt(normfin*normini);
  }

  <span class="comment">// write fourier bessel coefficients</span>

  fprintf(fp, <span class="stringliteral">&quot;# Rc      = %8.3f\n&quot;</span>, Rc);
  fprintf(fp, <span class="stringliteral">&quot;# qmax    = %8.3f\n&quot;</span>, qmax);
  fprintf(fp, <span class="stringliteral">&quot;# npoints = %d\n&quot;</span>, npoints-1);

  fprintf(fp, <span class="stringliteral">&quot;\n#nu\tq[nu]\ta[nu]\n&quot;</span>);

  <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++)
    fprintf(fp, <span class="stringliteral">&quot;%d\t%8.3f\t%15.8g\n&quot;</span>, nu, qnu[nu], anu[nu]);

}  
</pre></div></p>

</div>
</div>
<a class="anchor" id="a43ac3e4aa3126633881db8c44e82d79c"></a><!-- doxytag: member="Formfactors.c::writeTransitionPointDensities" ref="a43ac3e4aa3126633881db8c44e82d79c" args="(FILE *fp, const Projection *P, const FormfactorPara *p, double rmax, int npointsr, int A, int l, int jfin, int pfin, int afin, int jini, int pini, int aini, void *ffactorme, const Eigenstates *E)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeTransitionPointDensities </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structProjection.html">Projection</a> *&nbsp;</td>
          <td class="paramname"> <em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>rmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>npointsr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>jfin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pfin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>afin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>jini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>aini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ffactorme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structEigenstates.html">Eigenstates</a> *&nbsp;</td>
          <td class="paramname"> <em>E</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00569">569</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>References <a class="el" href="sphericalbessel_8c_source.html#l00027">besselj0()</a>, <a class="el" href="physics_8c_source.html#l00112">fneutron()</a>, <a class="el" href="physics_8c_source.html#l00101">fproton()</a>, <a class="el" href="MinimizerDONLP2orthogonalvapp_8c_source.html#l00108">ifix</a>, <a class="el" href="Projection_8h_source.html#l00147">Eigenstates::index</a>, <a class="el" href="Projection_8h_source.html#l00093">Projection::jmax</a>, <a class="el" href="Projection_8h_source.html#l00148">Eigenstates::norm</a>, <a class="el" href="Formfactors_8h_source.html#l00027">FormfactorPara::npoints</a>, <a class="el" href="donlp2_8h_source.html#l00117">phase</a>, <a class="el" href="Formfactors_8h_source.html#l00026">FormfactorPara::qmax</a>, <a class="el" href="ProjectedDensityMatrixHO_8c_source.html#l00065">rho</a>, and <a class="el" href="calcbasisovlapmulti_8c_source.html#l00032">SQR</a>.</p>

<p>Referenced by <a class="el" href="calctransitionpointdensities_8c_source.html#l00029">main()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> jmax = P-&gt;<a class="code" href="structProjection.html#aaab8cf237ff5e23d0f7abb05117387fe" title="calculate up to (jmax-1)/2">jmax</a>;
  <span class="keywordtype">int</span> ipjini = idxpij(jmax,pini,jini);
  <span class="keywordtype">int</span> ipjfin = idxpij(jmax,pfin,jfin);
  <span class="keywordtype">int</span> npoints = p-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
  <span class="keywordtype">double</span> qmax = p-&gt;<a class="code" href="structFormfactorPara.html#a1e3e2bcd9f63c49e819a5916614673e1">qmax</a>;
  <span class="keywordtype">int</span> idxfin = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipjfin][afin];
  <span class="keywordtype">int</span> idxini = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipjini][aini];
  <span class="keywordtype">double</span> normfin = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipjfin][idxfin];
  <span class="keywordtype">double</span> normini = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipjini][idxini];
  complex double (****ffctme)[2*npoints] = ffactorme;
  complex double (*ff)[npoints] = 
    ffctme[ipjfin][ipjini][idxfin][idxini];
  complex <span class="keywordtype">double</span> anu[npoints][2];

  <span class="keywordtype">int</span> i, nu;
  complex <span class="keywordtype">double</span> ff0, <a class="code" href="donlp2_8h.html#accf3aec63bc20b3c99ab4881cb07c05b">phase</a>;
  <span class="keywordtype">double</span> qnu[npoints];
  <span class="keywordtype">double</span> Rc = M_PI*(npoints-1)/qmax;

  <span class="keywordflow">if</span> (<a class="code" href="HOBasis_8c.html#a89606eca6b563ec68d2da2e84657736f">l</a> != 0) {
    fprintf(stderr, <span class="stringliteral">&quot;writeTransitionPointDensities not yet implemented for l != 0\n&quot;</span>);
    exit(-1);
  }

  <span class="comment">// get rid of possible phase factor</span>

  <span class="keywordtype">int</span> <a class="code" href="MinimizerDONLP2orthogonalvapp_8c.html#a25b7899372667d4f2f54730eae52607e">ifix</a>=npoints/3;
  <span class="keywordtype">double</span> qfix=qmax*ifix/(npoints-1);

  ff0 = ff[0][ifix]*<a class="code" href="physics_8c.html#ae2b9a725d285683c6ebccec5b8fb5d4c">fproton</a>(qfix)+ff[1][ifix]*<a class="code" href="physics_8c.html#a7739fcc8d2b58be4799956cfcae01c6e">fneutron</a>(qfix);
  phase = ff0/cabs(ff0);

  <span class="comment">// calculate coefficients anu</span>
  <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++) {
    qnu[nu] = M_PI*nu/Rc;
    anu[nu][0] = 1/sqrt(4*M_PI)*<a class="code" href="calcbasisovlapmulti_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(qnu[nu])/(2*M_PI*Rc)*
      creal(ff[0][nu]/phase)/sqrt(normfin*normini);
    anu[nu][1] = 1/sqrt(4*M_PI)*<a class="code" href="calcbasisovlapmulti_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(qnu[nu])/(2*M_PI*Rc)*
      creal(ff[1][nu]/phase)/sqrt(normfin*normini);
  }

  <span class="comment">// calculate densities </span>
      
  <span class="keywordtype">double</span> deltar=rmax/(npointsr-1);
  <span class="keywordtype">double</span> <a class="code" href="ProjectedDensityMatrixHO_8c.html#a103956ea26133e0b04f20e47636c5f03">rho</a>, rhop, rhon;

  <span class="keywordflow">for</span> (i=0; i&lt;npointsr; i++) {

    rho = 0.0; 
    <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++)
      rho += (anu[nu][0]+anu[nu][1])*<a class="code" href="sphericalbessel_8c.html#ac0cec34703d518b21b372ea6e6bc3cef">besselj0</a>(qnu[nu]*i*deltar);

    rhop = 0.0; 
    <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++)
      rhop += anu[nu][0]*<a class="code" href="sphericalbessel_8c.html#ac0cec34703d518b21b372ea6e6bc3cef">besselj0</a>(qnu[nu]*i*deltar);

    rhon = 0.0; 
    <span class="keywordflow">for</span> (nu=1; nu&lt;npoints; nu++)
      rhon += anu[nu][1]*<a class="code" href="sphericalbessel_8c.html#ac0cec34703d518b21b372ea6e6bc3cef">besselj0</a>(qnu[nu]*i*deltar);

    fprintf(fp, <span class="stringliteral">&quot;%6.3f\t%15.8g\t%15.8g\t%15.8g\n&quot;</span>, 
            i*deltar, rho, rhop, rhon);
  }
}  
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9fc5d29aff37ebaeb3b7753c06c1697c"></a><!-- doxytag: member="Formfactors.c::writeTransitionPointFormfactors" ref="a9fc5d29aff37ebaeb3b7753c06c1697c" args="(FILE *fp, const Projection *P, const FormfactorPara *p, int l, int jfin, int pfin, int afin, int jini, int pini, int aini, void *ffactorme, const Eigenstates *E)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeTransitionPointFormfactors </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structProjection.html">Projection</a> *&nbsp;</td>
          <td class="paramname"> <em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structFormfactorPara.html">FormfactorPara</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>jfin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pfin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>afin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>jini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>aini</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ffactorme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structEigenstates.html">Eigenstates</a> *&nbsp;</td>
          <td class="paramname"> <em>E</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00251">251</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>References <a class="el" href="MinimizerDONLP2orthogonalvapp_8c_source.html#l00108">ifix</a>, <a class="el" href="Projection_8h_source.html#l00147">Eigenstates::index</a>, <a class="el" href="Projection_8h_source.html#l00093">Projection::jmax</a>, <a class="el" href="Projection_8h_source.html#l00148">Eigenstates::norm</a>, <a class="el" href="Formfactors_8h_source.html#l00027">FormfactorPara::npoints</a>, <a class="el" href="donlp2_8h_source.html#l00117">phase</a>, and <a class="el" href="Formfactors_8h_source.html#l00026">FormfactorPara::qmax</a>.</p>

<p>Referenced by <a class="el" href="calctransitionpointformfactors_8c_source.html#l00029">main()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> jmax = P-&gt;<a class="code" href="structProjection.html#aaab8cf237ff5e23d0f7abb05117387fe" title="calculate up to (jmax-1)/2">jmax</a>;
  <span class="keywordtype">int</span> ipjfin = idxpij(jmax,pfin,jfin);
  <span class="keywordtype">int</span> ipjini = idxpij(jmax,pini,jini);
  <span class="keywordtype">int</span> npoints = p-&gt;<a class="code" href="structFormfactorPara.html#a53ecf776540b993bfd545349361deae3">npoints</a>;
  <span class="keywordtype">double</span> qmax = p-&gt;<a class="code" href="structFormfactorPara.html#a1e3e2bcd9f63c49e819a5916614673e1">qmax</a>;
  <span class="keywordtype">int</span> idxfin = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipjfin][afin];
  <span class="keywordtype">int</span> idxini = E-&gt;<a class="code" href="structEigenstates.html#a0a44e079b2e594d09a15d3a1ddd4a35c" title="indexing eigenstates according to &amp;quot;goodness&amp;quot;">index</a>[ipjini][aini];
  <span class="keywordtype">double</span> normfin = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipjfin][idxfin];
  <span class="keywordtype">double</span> normini = E-&gt;<a class="code" href="structEigenstates.html#aafb83e8289ec1cb2c7e882311c35ea3a" title="many-body norm^2 of eigenstates">norm</a>[ipjini][idxini];
  complex double (****ffctme)[2*npoints] = ffactorme;
  complex double (*ff)[npoints] = 
    ffctme[ipjfin][ipjini][idxfin][idxini];
  <span class="keywordtype">int</span> i;
  <span class="keywordtype">double</span> <a class="code" href="MinimizerDONLP2_8c.html#a116d67c73cdfa395275c96c0151ddcd4">q</a>;
  <span class="keywordtype">double</span> mlp, mln, ml;
  complex <span class="keywordtype">double</span> ff0p, ff0n, <a class="code" href="donlp2_8h.html#accf3aec63bc20b3c99ab4881cb07c05b">phase</a>;
  
  <span class="comment">// get rid of possible phase factors</span>
  <span class="comment">// formfactor should be real and positive for q=0</span>
  
  <span class="keywordtype">int</span> <a class="code" href="MinimizerDONLP2orthogonalvapp_8c.html#a25b7899372667d4f2f54730eae52607e">ifix</a>=npoints/3;

  <span class="comment">// average over proton and neutron phasese (is this correct ?)</span>
  ff0p = ff[0][ifix]; ff0n = ff[1][ifix];
  phase = 0.5*(ff0p/cabs(ff0p)+ff0n/cabs(ff0n));

  <span class="keywordflow">for</span> (i=0; i&lt;npoints; i++) {
    q = qmax*i/(npoints-1);

    mlp = creal(ff[0][i]/phase)/sqrt(normfin*normini);
    mln = creal(ff[1][i]/phase)/sqrt(normfin*normini);
    ml = creal((ff[0][i]+ff[1][i])/phase)/sqrt(normfin*normini);

    fprintf(fp, <span class="stringliteral">&quot;%6.3f\t%13.8g\t%13.8g\t%13.8g\n&quot;</span>,
            q,
            sqrt(jfin+1.0)*ml,
            sqrt(jfin+1.0)*mlp,
            sqrt(jfin+1.0)*mln);
  }
}
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ac00848d0b72a3c999e09ad3573a7b358"></a><!-- doxytag: member="Formfactors.c::diml" ref="ac00848d0b72a3c999e09ad3573a7b358" args="[NMULTIPOLES]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="Formfactors_8c.html#ac00848d0b72a3c999e09ad3573a7b358">diml</a>[NMULTIPOLES] = {1, 3, 5, 7}</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00131">131</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae91c198a9dcb2a8656748bd22d1c2dea"></a><!-- doxytag: member="Formfactors.c::fflabel" ref="ae91c198a9dcb2a8656748bd22d1c2dea" args="[NMULTIPOLES]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="Formfactors_8c.html#ae91c198a9dcb2a8656748bd22d1c2dea">fflabel</a>[NMULTIPOLES]</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> { <span class="stringliteral">&quot;EMonopole&quot;</span>, 
                               <span class="stringliteral">&quot;EDipole&quot;</span>, 
                               <span class="stringliteral">&quot;EQuadrupole&quot;</span>, 
                               <span class="stringliteral">&quot;EOctupole&quot;</span> }
</pre></div>
<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00039">39</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>Referenced by <a class="el" href="Formfactors_8c_source.html#l00055">initOpFormfactors()</a>.</p>

</div>
</div>
<a class="anchor" id="ad0f7f465a16cc1f1a73d9f2f7f799647"></a><!-- doxytag: member="Formfactors.c::il" ref="ad0f7f465a16cc1f1a73d9f2f7f799647" args="[NMULTIPOLES]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="Formfactors_8c.html#ad0f7f465a16cc1f1a73d9f2f7f799647">il</a>[NMULTIPOLES] = {0, 1, 4, 9}</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00130">130</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>Referenced by <a class="el" href="DensityMatrixHO_8c_source.html#l00094">calcDensityMatrixHOod()</a>.</p>

</div>
</div>
<a class="anchor" id="ae9b23ef5773aed752a74d4f815eb992d"></a><!-- doxytag: member="Formfactors.c::OpMultipoleFormfactor" ref="ae9b23ef5773aed752a74d4f815eb992d" args="[NMULTIPOLES]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structManyBodyOperator.html">ManyBodyOperator</a> <a class="el" href="Formfactors_8h.html#ab054d35ece12c38365c887792af15763">OpMultipoleFormfactor</a>[NMULTIPOLES]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00045">45</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>Referenced by <a class="el" href="calcchargedensities_8c_source.html#l00029">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a590d8229561cc50d158aad7a0481d2bc"></a><!-- doxytag: member="Formfactors.c::OpMultipoleFormfactors" ref="a590d8229561cc50d158aad7a0481d2bc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structManyBodyOperators.html">ManyBodyOperators</a> <a class="el" href="Formfactors_8h.html#a590d8229561cc50d158aad7a0481d2bc">OpMultipoleFormfactors</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
 <a class="code" href="HOBasis_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> : NMULTIPOLES,
 Op : <a class="code" href="Formfactors_8c.html#ae9b23ef5773aed752a74d4f815eb992d">OpMultipoleFormfactor</a>,
 me : <a class="code" href="Formfactors_8c.html#a05e5e93b5c85a383d9a5c1801571a7b6">calcMultipoleFormfactorsod</a>
}
</pre></div>
<p>Definition at line <a class="el" href="Formfactors_8c_source.html#l00048">48</a> of file <a class="el" href="Formfactors_8c_source.html">Formfactors.c</a>.</p>

<p>Referenced by <a class="el" href="calcformfactorsme_8c_source.html#l00029">main()</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 4 2012 14:05:35 for FMD by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
